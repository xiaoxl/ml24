<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Machine Learning Fall 2024 - 2&nbsp; k-Nearest Neighbors algorithm (k-NN)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../contents/3/intro.html" rel="next">
<link href="../../contents/1/intro.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Machine Learning Fall 2024</span>
    </a>
  </div>
        <div class="quarto-navbar-tools">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../contents/2/intro.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">k-Nearest Neighbors algorithm (k-NN)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/1/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/2/intro.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">k-Nearest Neighbors algorithm (k-NN)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/3/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Decision Trees</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/4/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Ensemble methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/5/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Logistic regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/6/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Netural networks</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#k-nearest-neighbors-algorithm-k-nn" id="toc-k-nearest-neighbors-algorithm-k-nn" class="nav-link active" data-scroll-target="#k-nearest-neighbors-algorithm-k-nn"><span class="header-section-number">2.1</span> k-Nearest Neighbors Algorithm (k-NN)</a>
  <ul class="collapse">
  <li><a href="#ideas" id="toc-ideas" class="nav-link" data-scroll-target="#ideas"><span class="header-section-number">2.1.1</span> Ideas</a></li>
  <li><a href="#the-algorithm" id="toc-the-algorithm" class="nav-link" data-scroll-target="#the-algorithm"><span class="header-section-number">2.1.2</span> The Algorithm</a></li>
  <li><a href="#details" id="toc-details" class="nav-link" data-scroll-target="#details"><span class="header-section-number">2.1.3</span> Details</a></li>
  <li><a href="#the-codes" id="toc-the-codes" class="nav-link" data-scroll-target="#the-codes"><span class="header-section-number">2.1.4</span> The codes</a></li>
  <li><a href="#sklearn-packages" id="toc-sklearn-packages" class="nav-link" data-scroll-target="#sklearn-packages"><span class="header-section-number">2.1.5</span> <code>sklearn</code> packages</a></li>
  <li><a href="#normalization" id="toc-normalization" class="nav-link" data-scroll-target="#normalization"><span class="header-section-number">2.1.6</span> Normalization</a></li>
  </ul></li>
  <li><a href="#k-nn-project-1-iris-classification" id="toc-k-nn-project-1-iris-classification" class="nav-link" data-scroll-target="#k-nn-project-1-iris-classification"><span class="header-section-number">2.2</span> k-NN Project 1: <code>iris</code> Classification</a>
  <ul class="collapse">
  <li><a href="#explore-the-dataset" id="toc-explore-the-dataset" class="nav-link" data-scroll-target="#explore-the-dataset"><span class="header-section-number">2.2.1</span> Explore the dataset</a></li>
  <li><a href="#sec-applyourknn" id="toc-sec-applyourknn" class="nav-link" data-scroll-target="#sec-applyourknn"><span class="header-section-number">2.2.2</span> Apply our k-NN model</a></li>
  <li><a href="#apply-k-nn-model-from-sklearn" id="toc-apply-k-nn-model-from-sklearn" class="nav-link" data-scroll-target="#apply-k-nn-model-from-sklearn"><span class="header-section-number">2.2.3</span> Apply k-NN model from <code>sklearn</code></a></li>
  <li><a href="#using-data-pipeline" id="toc-using-data-pipeline" class="nav-link" data-scroll-target="#using-data-pipeline"><span class="header-section-number">2.2.4</span> Using data pipeline</a></li>
  <li><a href="#visualize-the-decision-boundary-optional" id="toc-visualize-the-decision-boundary-optional" class="nav-link" data-scroll-target="#visualize-the-decision-boundary-optional"><span class="header-section-number">2.2.5</span> Visualize the Decision boundary [Optional]</a></li>
  <li><a href="#sec-cross-validation" id="toc-sec-cross-validation" class="nav-link" data-scroll-target="#sec-cross-validation"><span class="header-section-number">2.2.6</span> k-Fold Cross-Validation</a></li>
  <li><a href="#choosing-a-k-value" id="toc-choosing-a-k-value" class="nav-link" data-scroll-target="#choosing-a-k-value"><span class="header-section-number">2.2.7</span> Choosing a <code>k</code> value</a></li>
  </ul></li>
  <li><a href="#k-nn-project-2-dating-classification" id="toc-k-nn-project-2-dating-classification" class="nav-link" data-scroll-target="#k-nn-project-2-dating-classification"><span class="header-section-number">2.3</span> k-NN Project 2: Dating Classification</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background"><span class="header-section-number">2.3.1</span> Background</a></li>
  <li><a href="#look-at-data" id="toc-look-at-data" class="nav-link" data-scroll-target="#look-at-data"><span class="header-section-number">2.3.2</span> Look at Data</a></li>
  <li><a href="#applying-knn" id="toc-applying-knn" class="nav-link" data-scroll-target="#applying-knn"><span class="header-section-number">2.3.3</span> Applying kNN</a></li>
  <li><a href="#choosing-k-value" id="toc-choosing-k-value" class="nav-link" data-scroll-target="#choosing-k-value"><span class="header-section-number">2.3.4</span> Choosing <code>k</code> Value</a></li>
  </ul></li>
  <li><a href="#k-nn-project-3-handwritten-recognition" id="toc-k-nn-project-3-handwritten-recognition" class="nav-link" data-scroll-target="#k-nn-project-3-handwritten-recognition"><span class="header-section-number">2.4</span> k-NN Project 3: Handwritten recognition</a>
  <ul class="collapse">
  <li><a href="#dataset-description" id="toc-dataset-description" class="nav-link" data-scroll-target="#dataset-description"><span class="header-section-number">2.4.1</span> Dataset description</a></li>
  <li><a href="#apply-k-nn" id="toc-apply-k-nn" class="nav-link" data-scroll-target="#apply-k-nn"><span class="header-section-number">2.4.2</span> Apply k-NN</a></li>
  </ul></li>
  <li><a href="#exercises-and-projects" id="toc-exercises-and-projects" class="nav-link" data-scroll-target="#exercises-and-projects"><span class="header-section-number">2.5</span> Exercises and Projects</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">k-Nearest Neighbors algorithm (k-NN)</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This algorithm is different from other algorithms covered in this course, that it doesn’t really extract features from the data. However, since its idea is easy to understand, we use it as our first step towards machine learning world.</p>
<p>Similar to other algorithms, we will only cover the beginning part of the algorithm. All later upgrades of the algorithms are left for yourselves to learn.</p>
<p>References: <span class="citation" data-cites="Har2012">[<a href="../../index.html#ref-Har2012" role="doc-biblioref">1</a>]</span>.</p>
<section id="k-nearest-neighbors-algorithm-k-nn" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="k-nearest-neighbors-algorithm-k-nn"><span class="header-section-number">2.1</span> k-Nearest Neighbors Algorithm (k-NN)</h2>
<section id="ideas" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="ideas"><span class="header-section-number">2.1.1</span> Ideas</h3>
<p>Assume that we have a set of labeled data <span class="math inline">\(\{(X_i, y_i)\}\)</span> where <span class="math inline">\(y_i\)</span> denotes the label. Given a new data <span class="math inline">\(X\)</span>, how do we determine the label of it?</p>
<p>k-NN algorithm starts from a very straightforward idea. We use the distances from the new data point <span class="math inline">\(X\)</span> to the known data points to identify the label. If <span class="math inline">\(X\)</span> is closer to <span class="math inline">\(y_i\)</span> points, then we will label <span class="math inline">\(X\)</span> as <span class="math inline">\(y_i\)</span>.</p>
<p>Let us take cities and countries as an example. <span style="color:red">New York</span> and <span style="color:red">Los Angeles</span> are U.S cities, and <span style="color:grey">Beijing</span> and <span style="color:grey">Shanghai</span> are Chinese cities. Now we would like to consider Tianjin and Russellville. Do they belong to China or U.S? We calculate the distances from Tianjin (resp. Russellville) to all four known cities. Since Tianjin is closer to <span style="color:grey">Beijing</span> and <span style="color:grey">Shanghai</span> comparing to <span style="color:red">New York</span> and <span style="color:red">Los Angeles</span>, we classify Tianjin as a Chinese city. Similarly, since Russellville is closer to <span style="color:red">New York</span> and <span style="color:red">Los Angeles</span> comparing to <span style="color:grey">Beijing</span> and <span style="color:grey">Shanghai</span>, we classify it as a U.S. city.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 465.48 354.87" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 350.87)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-350.87 461.48,-350.87 461.48,4 -4,4"></polygon>
<!-- Beijing -->
<g id="node1" class="node">
<title>Beijing</title>
<ellipse fill="none" stroke="black" cx="316.2" cy="-18" rx="39.44" ry="18"></ellipse>
<text text-anchor="middle" x="316.2" y="-13.8" font-family="Times,serif" font-size="14.00">Beijing</text>
</g>
<!-- Shanghai -->
<g id="node2" class="node">
<title>Shanghai</title>
<ellipse fill="none" stroke="black" cx="46.98" cy="-173.44" rx="46.95" ry="18"></ellipse>
<text text-anchor="middle" x="46.98" y="-169.24" font-family="Times,serif" font-size="14.00">Shanghai</text>
</g>
<!-- Tianjin -->
<g id="node3" class="node">
<title>Tianjin</title>
<polygon fill="none" stroke="blue" points="165.15,-36 108.28,-36 108.28,0 165.15,0 165.15,-36"></polygon>
<text text-anchor="middle" x="136.72" y="-13.8" font-family="Times,serif" font-size="14.00">Tianjin</text>
</g>
<!-- Tianjin&#45;&gt;Beijing -->
<g id="edge1" class="edge">
<title>Tianjin-&gt;Beijing</title>
<path fill="none" stroke="black" d="M165.16,-18C192.27,-18 233.69,-18 266.3,-18"></path>
<polygon fill="black" stroke="black" points="266.55,-21.5 276.55,-18 266.55,-14.5 266.55,-21.5"></polygon>
<text text-anchor="middle" x="199.02" y="-22.2" font-family="Times,serif" font-size="14.00">closer</text>
</g>
<!-- Tianjin&#45;&gt;Shanghai -->
<g id="edge2" class="edge">
<title>Tianjin-&gt;Shanghai</title>
<path fill="none" stroke="black" d="M126.25,-36.13C110.51,-63.4 80.66,-115.1 62.42,-146.69"></path>
<polygon fill="black" stroke="black" points="59.35,-145.01 57.38,-155.42 65.41,-148.51 59.35,-145.01"></polygon>
<text text-anchor="middle" x="72.37" y="-95.61" font-family="Times,serif" font-size="14.00">closer &nbsp;&nbsp;</text>
</g>
<!-- New York -->
<g id="node4" class="node">
<title>New York</title>
<ellipse fill="none" stroke="red" cx="405.94" cy="-173.44" rx="51.56" ry="18"></ellipse>
<text text-anchor="middle" x="405.94" y="-169.24" font-family="Times,serif" font-size="14.00" fill="red">New York</text>
</g>
<!-- Tianjin&#45;&gt;New York -->
<g id="edge3" class="edge">
<title>Tianjin-&gt;New York</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M165.02,-34.34C214.41,-62.86 316.22,-121.64 370.33,-152.87"></path>
<polygon fill="blue" stroke="blue" points="368.81,-156.04 379.22,-158.01 372.31,-149.98 368.81,-156.04"></polygon>
<text text-anchor="middle" x="241.64" y="-97.81" font-family="Times,serif" font-size="14.00" fill="blue"> far away</text>
</g>
<!-- Los Angelis -->
<g id="node5" class="node">
<title>Los Angelis</title>
<ellipse fill="none" stroke="red" cx="136.72" cy="-328.87" rx="57.95" ry="18"></ellipse>
<text text-anchor="middle" x="136.72" y="-324.67" font-family="Times,serif" font-size="14.00" fill="red">Los Angelis</text>
</g>
<!-- Tianjin&#45;&gt;Los Angelis -->
<g id="edge4" class="edge">
<title>Tianjin-&gt;Los Angelis</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M136.72,-36.06C136.72,-87.89 136.72,-237.44 136.72,-300.4"></path>
<polygon fill="blue" stroke="blue" points="133.22,-300.77 136.72,-310.77 140.22,-300.77 133.22,-300.77"></polygon>
<text text-anchor="middle" x="162.76" y="-172.43" font-family="Times,serif" font-size="14.00" fill="blue"> far away</text>
</g>
<!-- Russellville -->
<g id="node6" class="node">
<title>Russellville</title>
<polygon fill="none" stroke="blue" points="357.31,-346.87 275.09,-346.87 275.09,-310.87 357.31,-310.87 357.31,-346.87"></polygon>
<text text-anchor="middle" x="316.2" y="-324.67" font-family="Times,serif" font-size="14.00" fill="red">Russellville</text>
</g>
<!-- Russellville&#45;&gt;Beijing -->
<g id="edge7" class="edge">
<title>Russellville-&gt;Beijing</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M316.2,-310.82C316.2,-258.98 316.2,-109.43 316.2,-46.47"></path>
<polygon fill="blue" stroke="blue" points="319.7,-46.11 316.2,-36.11 312.7,-46.11 319.7,-46.11"></polygon>
<text text-anchor="middle" x="290.16" y="-182.84" font-family="Times,serif" font-size="14.00" fill="blue">far away </text>
</g>
<!-- Russellville&#45;&gt;Shanghai -->
<g id="edge8" class="edge">
<title>Russellville-&gt;Shanghai</title>
<path fill="none" stroke="blue" stroke-dasharray="5,2" d="M284.79,-310.74C234.05,-281.44 134.4,-223.91 81.65,-193.45"></path>
<polygon fill="blue" stroke="blue" points="83.39,-190.42 72.98,-188.45 79.89,-196.48 83.39,-190.42"></polygon>
<text text-anchor="middle" x="158.93" y="-256.3" font-family="Times,serif" font-size="14.00" fill="blue">far away</text>
</g>
<!-- Russellville&#45;&gt;New York -->
<g id="edge5" class="edge">
<title>Russellville-&gt;New York</title>
<path fill="none" stroke="red" d="M326.67,-310.74C342.41,-283.48 372.26,-231.78 390.5,-200.18"></path>
<polygon fill="red" stroke="red" points="393.57,-201.87 395.54,-191.46 387.51,-198.37 393.57,-201.87"></polygon>
<text text-anchor="middle" x="338.37" y="-259.66" font-family="Times,serif" font-size="14.00" fill="red">closer &nbsp;</text>
</g>
<!-- Russellville&#45;&gt;Los Angelis -->
<g id="edge6" class="edge">
<title>Russellville-&gt;Los Angelis</title>
<path fill="none" stroke="red" d="M275.02,-328.87C254.29,-328.87 228.6,-328.87 205.02,-328.87"></path>
<polygon fill="red" stroke="red" points="204.71,-325.37 194.71,-328.87 204.71,-332.37 204.71,-325.37"></polygon>
<text text-anchor="middle" x="223.31" y="-333.07" font-family="Times,serif" font-size="14.00" fill="red">closer</text>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>This naive example explains the idea of k-NN. Here is a more detailed description of the algorithm.</p>
</section>
<section id="the-algorithm" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="the-algorithm"><span class="header-section-number">2.1.2</span> The Algorithm</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
k-NN Classifier
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Inputs</strong>: Given the training data set <span class="math inline">\(\{(X_i, y_i)\}\)</span> where <span class="math inline">\(X_i=(x_i^1,x_i^2,\ldots,x_i^n)\)</span> represents <span class="math inline">\(n\)</span> features and <span class="math inline">\(y_i\)</span> represents labels. Given a new data point <span class="math inline">\(\tilde{X}=(\tilde{x}^1,\tilde{x}^2,\ldots,\tilde{x}^n)\)</span>.</p>
<p><strong>Outputs</strong>: Want to find the best label for <span class="math inline">\(\tilde{X}\)</span>.</p>
<ol type="1">
<li>Compute the distance from <span class="math inline">\(\tilde{X}\)</span> to each <span class="math inline">\(X_i\)</span>.</li>
<li>Sort all these distances from the nearest to the furthest.</li>
<li>Find the nearest <span class="math inline">\(k\)</span> data points.</li>
<li>Determine the labels for each of these <span class="math inline">\(k\)</span> nearest points, and compute the frenqucy of each labels.</li>
<li>The most frequent label is considered to be the label of <span class="math inline">\(\tilde{X}\)</span>.</li>
</ol>
</div>
</div>
</section>
<section id="details" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="details"><span class="header-section-number">2.1.3</span> Details</h3>
<ul>
<li>The distance between two data points are defined by the Euclidean distance:</li>
</ul>
<p><span class="math display">\[
dist\left((x^j_i)_{j=1}^n, (\tilde{x}^j)_{j=1}^n\right)=\sqrt{\sum_{j=1}^n(x^j_i-\tilde{x}^j)^2}.
\]</span></p>
<ul>
<li>Using linear algebra notations:</li>
</ul>
<p><span class="math display">\[
dist(X_i,\tilde{X})=\sqrt{(X_i-\tilde{X})\cdot(X_i-\tilde{X})}.
\]</span></p>
<ul>
<li>All the distances are stored in a <span class="math inline">\(1\)</span>-dim numpy array, and we will combine it together with another <span class="math inline">\(1\)</span>-dim array that store the labels of each point.</li>
</ul>
</section>
<section id="the-codes" class="level3" data-number="2.1.4">
<h3 data-number="2.1.4" class="anchored" data-anchor-id="the-codes"><span class="header-section-number">2.1.4</span> The codes</h3>
<ul>
<li><code>argsort</code></li>
<li><code>unique</code></li>
<li><code>argmax</code></li>
</ul>
<div id="31212505" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">def</span> classify_kNN(inX, X, y, k<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="co"># compute the distance between each row of X and Xmat</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>    Dmat <span class="op">=</span> np.sqrt(((inX <span class="op">-</span> X)<span class="op">**</span><span class="dv">2</span>).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="co"># sort by distance</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>    k <span class="op">=</span> <span class="bu">min</span>(k, Dmat.shape[<span class="dv">0</span>])</span>
<span id="cb1-8"><a href="#cb1-8"></a>    argsorted <span class="op">=</span> Dmat.argsort()[:k]</span>
<span id="cb1-9"><a href="#cb1-9"></a>    relatedy <span class="op">=</span> y[argsorted]</span>
<span id="cb1-10"><a href="#cb1-10"></a>    <span class="co"># count the freq. of the first k labels</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>    labelcounts <span class="op">=</span> np.unique(relatedy, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-12"><a href="#cb1-12"></a>    <span class="co"># find the label with the most counts</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>    label <span class="op">=</span> labelcounts[<span class="dv">0</span>][labelcounts[<span class="dv">1</span>].argmax()]</span>
<span id="cb1-14"><a href="#cb1-14"></a>    <span class="cf">return</span> label</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sklearn-packages" class="level3" data-number="2.1.5">
<h3 data-number="2.1.5" class="anchored" data-anchor-id="sklearn-packages"><span class="header-section-number">2.1.5</span> <code>sklearn</code> packages</h3>
<p>You may also directly use the kNN function <code>KNeighborsClassifier</code> packaged in <code>sklearn.neighbors</code>. You may check the description of the function online from <a href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.KNeighborsClassifier.html">here</a>.</p>
<p>There are many ways to modify the kNN algorithm. What we just mentioned is the simplest idea. It is correspondent to the argument <code>weights='uniform'</code>, <code>algorithm='brute</code> and <code>metric='euclidean'</code>. However due to the implementation details, the results we got from <code>sklearn</code> are still a little bit different from the results produced by our naive codes.</p>
<div id="17b54ab3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb2-2"><a href="#cb2-2"></a>clf <span class="op">=</span> KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">10</span>, weights<span class="op">=</span><span class="st">'uniform'</span>,</span>
<span id="cb2-3"><a href="#cb2-3"></a>                           algorithm<span class="op">=</span><span class="st">'brute'</span>, metric<span class="op">=</span><span class="st">'euclidean'</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a>clf.fit(X_train, y_train)</span>
<span id="cb2-5"><a href="#cb2-5"></a>y_pred <span class="op">=</span> clf.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="normalization" class="level3" data-number="2.1.6">
<h3 data-number="2.1.6" class="anchored" data-anchor-id="normalization"><span class="header-section-number">2.1.6</span> Normalization</h3>
<p>Different features may have different scales. It might be unfair for those features that have small scales. Therefore usually it is better to rescale all the features to make them have similar scales. After examining all the data, we find the minimal value <code>minVal</code> and the range <code>ranges</code> for each column. The normalization formula is:</p>
<p><span class="math display">\[
X_{norm} = \frac{X_{original}-minVal}{ranges}.
\]</span></p>
<p>We could also convert the normalized number back to the original value by</p>
<p><span class="math display">\[
X_{original} = X_{norm} \times ranges + minVal.
\]</span></p>
<p>The sample codes are listed below.</p>
<div id="f9f7e873" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">def</span> encodeNorm(X, parameters<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="co"># parameters contains minVals and ranges</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="cf">if</span> parameters <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb3-6"><a href="#cb3-6"></a>        minVals <span class="op">=</span> np.<span class="bu">min</span>(X, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb3-7"><a href="#cb3-7"></a>        maxVals <span class="op">=</span> np.<span class="bu">max</span>(X, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a>        ranges <span class="op">=</span> np.maximum(maxVals <span class="op">-</span> minVals, np.ones(minVals.size))</span>
<span id="cb3-9"><a href="#cb3-9"></a>        parameters <span class="op">=</span> {<span class="st">'ranges'</span>: ranges, <span class="st">'minVals'</span>: minVals}</span>
<span id="cb3-10"><a href="#cb3-10"></a>    <span class="cf">else</span>:</span>
<span id="cb3-11"><a href="#cb3-11"></a>        minVals <span class="op">=</span> parameters[<span class="st">'minVals'</span>]</span>
<span id="cb3-12"><a href="#cb3-12"></a>        ranges <span class="op">=</span> parameters[<span class="st">'ranges'</span>]</span>
<span id="cb3-13"><a href="#cb3-13"></a>    Nmat <span class="op">=</span> np.tile(minVals, (X.shape[<span class="dv">0</span>], <span class="dv">1</span>))</span>
<span id="cb3-14"><a href="#cb3-14"></a>    Xnorm <span class="op">=</span> (X <span class="op">-</span> Nmat)<span class="op">/</span>ranges</span>
<span id="cb3-15"><a href="#cb3-15"></a>    <span class="cf">return</span> (Xnorm, parameters)</span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="kw">def</span> decodeNorm(X, parameters):</span>
<span id="cb3-19"><a href="#cb3-19"></a>    <span class="co"># parameters contains minVals and ranges</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>    ranges <span class="op">=</span> parameters[<span class="st">'ranges'</span>]</span>
<span id="cb3-21"><a href="#cb3-21"></a>    minVals <span class="op">=</span> parameters[<span class="st">'minVals'</span>]</span>
<span id="cb3-22"><a href="#cb3-22"></a>    Nmat <span class="op">=</span> np.tile(minVals, (X.shape[<span class="dv">0</span>], <span class="dv">1</span>))</span>
<span id="cb3-23"><a href="#cb3-23"></a>    Xoriginal <span class="op">=</span> X <span class="op">*</span> ranges <span class="op">+</span> Nmat</span>
<span id="cb3-24"><a href="#cb3-24"></a>    <span class="cf">return</span> Xoriginal</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you use <code>sklearn</code> you could use <code>MinMaxScaler</code> from <code>sklearn.preprocessing</code> to achive the same goal. The related codes will be discussed later in projects. I keep our handwritten codes here for Python practicing.</p>
</section>
</section>
<section id="k-nn-project-1-iris-classification" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="k-nn-project-1-iris-classification"><span class="header-section-number">2.2</span> k-NN Project 1: <code>iris</code> Classification</h2>
<p>This data is from <code>sklearn.datasets</code>. This dataset consists of 3 different types of irises’ petal / sepal length / width, stored in a <span class="math inline">\(150\times4\)</span> <code>numpy.ndarray</code>. We already explored the dataset briefly in the previous chapter. This time we will try to use the feature provided to predict the type of the irises. For the purpose of plotting, we will only use the first two features: <code>sepal length</code> and <code>sepal width</code>.</p>
<section id="explore-the-dataset" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="explore-the-dataset"><span class="header-section-number">2.2.1</span> Explore the dataset</h3>
<p>We first load the dataset.</p>
<div id="c190f0ae" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb4-2"><a href="#cb4-2"></a>iris <span class="op">=</span> datasets.load_iris()</span>
<span id="cb4-3"><a href="#cb4-3"></a>X <span class="op">=</span> iris.data[:, :<span class="dv">2</span>]</span>
<span id="cb4-4"><a href="#cb4-4"></a>y <span class="op">=</span> iris.target</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we would like to split the dataset into trainning data and test data. Here we are going to use <code>sklearn.model_selection.train_test_split</code> function. Besides the dataset, we should also provide the propotion of the test set comparing to the whole dataset. We will choose <code>test_size=0.1</code> here, which means that the size of the test set is 0.1 times the size of the whole dataset. <code>stratify=y</code> means that when split the dataset we want to split respects the distribution of labels in <code>y</code>.</p>
<p>The split will be randomly. You may set the argument <code>random_state</code> to be a certain number to control the random process. If you set a <code>random_state</code>, the result of the random process will stay the same. This is for reproducible output across multiple function calls.</p>
<p>After we get the training set, we should also normalize it. All our normalization should be based on the training set. When we want to use our model on some new data points, we will use the same normalization parameters to normalize the data points in interests right before we apply the model. Here since we mainly care about the test set, we could normalize the test set at this stage.</p>
<p>Note that in the following code, the function <code>encodeNorm</code> defined in the previous section is used. <!-- I import it from `assests.codes.knn`. You need to modify this part based on your file structure. See @sec-applyourknn for more details. --></p>
<div id="1f069279" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.1</span>, random_state<span class="op">=</span><span class="dv">1</span>, stratify<span class="op">=</span>y)</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a>X_train_norm, parameters <span class="op">=</span> encodeNorm(X_train)</span>
<span id="cb5-6"><a href="#cb5-6"></a>X_test_norm, _ <span class="op">=</span> encodeNorm(X_test, parameters<span class="op">=</span>parameters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we start to play with k-NN, let us look at the data first. Since we only choose two features, it is able to plot these data points on a 2D plane, with different colors representing different classes.</p>
<div id="30bf5579" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># Plot the scatter plot.</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb6-6"><a href="#cb6-6"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)</span>
<span id="cb6-7"><a href="#cb6-7"></a>scatter <span class="op">=</span> ax.scatter(X_train[:, <span class="dv">0</span>], X_train[:, <span class="dv">1</span>], c<span class="op">=</span>y_train)</span>
<span id="cb6-8"><a href="#cb6-8"></a></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co"># Generate legends.</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>labels <span class="op">=</span> [<span class="st">'setosa'</span>, <span class="st">'versicolor'</span>, <span class="st">'virginica'</span>]</span>
<span id="cb6-11"><a href="#cb6-11"></a>_ <span class="op">=</span> fig.legend(handles<span class="op">=</span>scatter.legend_elements()[<span class="dv">0</span>], labels<span class="op">=</span>labels,</span>
<span id="cb6-12"><a href="#cb6-12"></a>               loc<span class="op">=</span><span class="st">"right"</span>, title<span class="op">=</span><span class="st">"Labels"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_files/figure-html/cell-7-output-1.png" width="883" height="560" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-applyourknn" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="sec-applyourknn"><span class="header-section-number">2.2.2</span> Apply our k-NN model</h3>
<p>Now let us apply k-NN to this dataset. We first use our codes. The poential code is</p>
<div id="df219ab3" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>y_pred <span class="op">=</span> classify_kNN(X_test, X_train, y_train, k<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However the above code is actually wrong. The issue is that our function <code>classify_kNN</code> can only classify one row of data. To classify many rows, we need to use a <code>for</code> loop.</p>
<div id="4b35eb87" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>n_neighbors <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>y_pred <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="cf">for</span> row <span class="kw">in</span> X_test_norm:</span>
<span id="cb8-4"><a href="#cb8-4"></a>    row_pred <span class="op">=</span> classify_kNN(row, X_train_norm, y_train, k<span class="op">=</span>n_neighbors)</span>
<span id="cb8-5"><a href="#cb8-5"></a>    y_pred.append(row_pred)</span>
<span id="cb8-6"><a href="#cb8-6"></a>y_pred <span class="op">=</span> np.array(y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could use list comprehension to simply the above codes.</p>
<div id="6ed73fad" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>n_neighbors <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>y_pred <span class="op">=</span> np.array([classify_kNN(row, X_train_norm, y_train, k<span class="op">=</span>n_neighbors)</span>
<span id="cb9-3"><a href="#cb9-3"></a>                   <span class="cf">for</span> row <span class="kw">in</span> X_test_norm])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This <code>y_pred</code> is the result we got for the test set. We may compare it with the real answer <code>y_test</code>, and calcuate the accuracy.</p>
<div id="198c2403" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>acc <span class="op">=</span> np.mean(y_pred <span class="op">==</span> y_test)</span>
<span id="cb10-2"><a href="#cb10-2"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>0.7333333333333333</code></pre>
</div>
</div>
</section>
<section id="apply-k-nn-model-from-sklearn" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="apply-k-nn-model-from-sklearn"><span class="header-section-number">2.2.3</span> Apply k-NN model from <code>sklearn</code></h3>
<p>Now we would like to use <code>sklearn</code> to reproduce this result. Since our data is prepared, what we need to do is directly call the functions.</p>
<div id="68bbc471" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb12-2"><a href="#cb12-2"></a>n_neighbors <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>clf <span class="op">=</span> KNeighborsClassifier(n_neighbors, weights<span class="op">=</span><span class="st">"uniform"</span>, metric<span class="op">=</span><span class="st">"euclidean"</span>,</span>
<span id="cb12-4"><a href="#cb12-4"></a>                           algorithm<span class="op">=</span><span class="st">'brute'</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a>clf.fit(X_train_norm, y_train)</span>
<span id="cb12-6"><a href="#cb12-6"></a>y_pred_sk <span class="op">=</span> clf.predict(X_test_norm)</span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a>acc <span class="op">=</span> np.mean(y_pred_sk <span class="op">==</span> y_test)</span>
<span id="cb12-9"><a href="#cb12-9"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0.7333333333333333</code></pre>
</div>
</div>
</section>
<section id="using-data-pipeline" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="using-data-pipeline"><span class="header-section-number">2.2.4</span> Using data pipeline</h3>
<p>We may organize the above process in a neater way. After we get a data, the usual process is to apply several transforms to the data before we really get to the model part. Using terminolgies from <code>sklearn</code>, the former are called <em>transforms</em>, and the latter is called an <em>estimator</em>. In this example, we have exactly one tranform which is the normalization. The estimator here we use is the k-NN classifier.</p>
<p><code>sklearn</code> provides a standard way to write these codes, which is called <code>pipeline</code>. We may chain the transforms and estimators in a sequence and let the data go through the pipeline. In this example, the pipeline contains two steps: 1. The normalization transform <code>sklearn.preprocessing.MinMaxScaler</code>. When we directly apply it the parameters <code>ranges</code> and <code>minVals</code> and will be recorded automatically, and we don’t need to worry about it when we want to use the same parameters to normalize other data. 2. The k-NN classifier <code>sklearn.neighbors.KNeighborsClassifier</code>. This is the same one as we use previously.</p>
<p>The code is as follows. It is a straightforward code. Note that the <code>()</code> after the class in each step of <code>steps</code> is very important. The codes cannot run if you miss it.</p>
<p>After we setup the pipeline, we may use it as other estimators since it is an estimator. Here we may also use the accuracy function provided by <code>sklearn</code> to perform the computation. It is essentially the same as our <code>acc</code> computation.</p>
<div id="320b2756" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a>steps <span class="op">=</span> [(<span class="st">'scaler'</span>, MinMaxScaler()),</span>
<span id="cb14-6"><a href="#cb14-6"></a>         (<span class="st">'knn'</span>, KNeighborsClassifier(n_neighbors, weights<span class="op">=</span><span class="st">"uniform"</span>,</span>
<span id="cb14-7"><a href="#cb14-7"></a>                                      metric<span class="op">=</span><span class="st">"euclidean"</span>, algorithm<span class="op">=</span><span class="st">'brute'</span>))]</span>
<span id="cb14-8"><a href="#cb14-8"></a>pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>steps)</span>
<span id="cb14-9"><a href="#cb14-9"></a>pipe.fit(X_train, y_train)</span>
<span id="cb14-10"><a href="#cb14-10"></a>y_pipe <span class="op">=</span> pipe.predict(X_test)</span>
<span id="cb14-11"><a href="#cb14-11"></a>accuracy_score(y_pipe, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>0.7333333333333333</code></pre>
</div>
</div>
</section>
<section id="visualize-the-decision-boundary-optional" class="level3" data-number="2.2.5">
<h3 data-number="2.2.5" class="anchored" data-anchor-id="visualize-the-decision-boundary-optional"><span class="header-section-number">2.2.5</span> Visualize the Decision boundary [Optional]</h3>
<p>Using the classifier we get above, we are able to classify every points on the plane. This enables us to draw the following plot, which is called the Decision boundary. It helps us to visualize the relations between features and the classes.</p>
<p>We use <code>DecisionBoundaryDisplay</code> from <code>sklearn.inspection</code> to plot the decision boundary. The function requires us to have a fitted classifier. We may use the classifier <code>pipe</code> we got above. Note that this classifier should have some build-in structures that our <code>classify_kNN</code> function doesn’t have. We may rewrite our codes to make it work, but this goes out of the scope of this section. This is supposed to be Python programming exercise. We will talk about it in the future if we have enough time.</p>
<p>We first plot the dicision boundary using <code>DecisionBoundaryDisplay.from_estimator</code>. Then we plot the points from <code>X_test</code>. From the plot it is very clear which points are misclassified.</p>
<div id="67245892" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> DecisionBoundaryDisplay</span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>disp <span class="op">=</span> DecisionBoundaryDisplay.from_estimator(</span>
<span id="cb16-4"><a href="#cb16-4"></a>            pipe, </span>
<span id="cb16-5"><a href="#cb16-5"></a>            X_train,</span>
<span id="cb16-6"><a href="#cb16-6"></a>            response_method<span class="op">=</span><span class="st">"predict"</span>,</span>
<span id="cb16-7"><a href="#cb16-7"></a>            plot_method<span class="op">=</span><span class="st">"pcolormesh"</span>,</span>
<span id="cb16-8"><a href="#cb16-8"></a>            xlabel<span class="op">=</span>iris.feature_names[<span class="dv">0</span>],</span>
<span id="cb16-9"><a href="#cb16-9"></a>            ylabel<span class="op">=</span>iris.feature_names[<span class="dv">1</span>],</span>
<span id="cb16-10"><a href="#cb16-10"></a>            alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb16-11"><a href="#cb16-11"></a>disp.ax_.scatter(X_test[:, <span class="dv">0</span>], X_test[:, <span class="dv">1</span>], c<span class="op">=</span>y_test, edgecolor<span class="op">=</span><span class="st">"k"</span>)</span>
<span id="cb16-12"><a href="#cb16-12"></a>disp.figure_.set_size_inches((<span class="dv">10</span>,<span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_files/figure-html/cell-14-output-1.png" width="812" height="577" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-cross-validation" class="level3" data-number="2.2.6">
<h3 data-number="2.2.6" class="anchored" data-anchor-id="sec-cross-validation"><span class="header-section-number">2.2.6</span> k-Fold Cross-Validation</h3>
<p>Previously we perform a random split and test our model in this case. What would happen if we fit our model on another split? We might get a different accuracy score. So in order to evaluate the performance of our model, it is natual to consider several different split and compute the accuracy socre for each case, and combine all these socres together to generate an index to indicate whehter our model is good or bad. This naive idea is called <em>k-Fold Cross-Validation</em>.</p>
<p>The algorithm is described as follows. We first randomly split the dataset into <code>k</code> groups. We use one of them as the test set, and the rest together forming the training set, and use this setting to get an accuracy score. We did this for each group to be chosen as the test set. Then the final score is the mean.</p>
<p><code>sklearn</code> provides a function <code>sklearn.model_selection.cross_val_score</code> to perform the above computation. The usage is straightforward, as follows.</p>
<div id="155060aa" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb17-2"><a href="#cb17-2"></a>cv_scores <span class="op">=</span> cross_val_score(pipe, X, y, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a>cv_scores</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>array([0.66666667, 0.8       , 0.63333333, 0.8       , 0.7       ])</code></pre>
</div>
</div>
<div id="bebbbe28" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>np.mean(cv_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>0.7200000000000001</code></pre>
</div>
</div>
</section>
<section id="choosing-a-k-value" class="level3" data-number="2.2.7">
<h3 data-number="2.2.7" class="anchored" data-anchor-id="choosing-a-k-value"><span class="header-section-number">2.2.7</span> Choosing a <code>k</code> value</h3>
<p>In the previous example we choose <code>k</code> to be <code>10</code> as an example. To choose a <code>k</code> value we usually run some test by trying different <code>k</code> and choose the one with the best performance. In this case, best performance means the highest cross-validation score.</p>
<p><code>sklearn.model_selection.GridSearchCV</code> provides a way to do this directly. We only need to setup the esitimator, the metric (which is the cross-validation score in this case), and the hyperparameters to be searched through, and <code>GridSearchCV</code> will run the search automatically.</p>
<p>We let <code>k</code> go from <code>1</code> to <code>100</code>. The code is as follows.</p>
<p>Note that <code>parameters</code> is where we set the search space. It is a dictionary. The key is the name of the estimator plus double <code>_</code> and then plus the name of the parameter.</p>
<div id="df150f4f" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb21-2"><a href="#cb21-2"></a>n_list <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">101</span>))</span>
<span id="cb21-3"><a href="#cb21-3"></a>parameters <span class="op">=</span> <span class="bu">dict</span>(knn__n_neighbors<span class="op">=</span>n_list)</span>
<span id="cb21-4"><a href="#cb21-4"></a>clf <span class="op">=</span> GridSearchCV(pipe, parameters)</span>
<span id="cb21-5"><a href="#cb21-5"></a>clf.fit(X, y)</span>
<span id="cb21-6"><a href="#cb21-6"></a>clf.best_estimator_.get_params()[<span class="st">"knn__n_neighbors"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>35</code></pre>
</div>
</div>
<p>After we fit the data, the <code>best_estimator_.get_params()</code> can be printed. It tells us that it is best to use <code>31</code> neibhours for our model. We can directly use the best estimator by calling <code>clf.best_estimator_</code>.</p>
<div id="fa936e44" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>cv_scores <span class="op">=</span> cross_val_score(clf.best_estimator_, X, y, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a>np.mean(cv_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>0.82</code></pre>
</div>
</div>
<p>The cross-validation score using <code>k=31</code> is calculated. This serves as a benchmark score and we may come back to dataset using other methods and compare the scores.</p>
</section>
</section>
<section id="k-nn-project-2-dating-classification" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="k-nn-project-2-dating-classification"><span class="header-section-number">2.3</span> k-NN Project 2: Dating Classification</h2>
<p>The data can be downloaded from <a href="./assests/datasets/datingTestSet2.txt">here</a>.</p>
<section id="background" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="background"><span class="header-section-number">2.3.1</span> Background</h3>
<p>Helen dated several people and rated them using a three-point scale: 3 is best and 1 is worst. She also collected data from all her dates and recorded them in the file attached. These data contains 3 features:</p>
<ul>
<li>Number of frequent flyer miles earned per year</li>
<li>Percentage of time spent playing video games</li>
<li>Liters of ice cream consumed per week</li>
</ul>
<p>We would like to predict her ratings of new dates when we are given the three features.</p>
<p>The data contains four columns, while the first column refers to <code>Mileage</code>, the second <code>Gamingtime</code>, the third <code>Icecream</code> and the fourth <code>Rating</code>.</p>
</section>
<section id="look-at-data" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="look-at-data"><span class="header-section-number">2.3.2</span> Look at Data</h3>
<p>We first load the data and store it into a DataFrame.</p>
<div id="aaaa65f3" class="cell" data-execution_count="18">
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>40920</td>
<td>8.326976</td>
<td>0.953952</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>14488</td>
<td>7.153469</td>
<td>1.673904</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>26052</td>
<td>1.441871</td>
<td>0.805124</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>75136</td>
<td>13.147394</td>
<td>0.428964</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>38344</td>
<td>1.669788</td>
<td>0.134296</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="47c5a3a3" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb25-4"><a href="#cb25-4"></a></span>
<span id="cb25-5"><a href="#cb25-5"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'datingTestSet2.txt'</span>, sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb25-6"><a href="#cb25-6"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To make it easier to read, we would like to change the name of the columns.</p>
<div id="341996eb" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>df <span class="op">=</span> df.rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">"Mileage"</span>, <span class="dv">1</span>: <span class="st">"Gamingtime"</span>, <span class="dv">2</span>: <span class="st">'Icecream'</span>, <span class="dv">3</span>: <span class="st">'Rating'</span>})</span>
<span id="cb26-2"><a href="#cb26-2"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mileage</th>
<th data-quarto-table-cell-role="th">Gamingtime</th>
<th data-quarto-table-cell-role="th">Icecream</th>
<th data-quarto-table-cell-role="th">Rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>40920</td>
<td>8.326976</td>
<td>0.953952</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>14488</td>
<td>7.153469</td>
<td>1.673904</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>26052</td>
<td>1.441871</td>
<td>0.805124</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>75136</td>
<td>13.147394</td>
<td>0.428964</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>38344</td>
<td>1.669788</td>
<td>0.134296</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Since now we have more than 2 features, it is not suitable to directly draw scatter plots. We use <code>seaborn.pairplot</code> to look at the pairplot. From the below plots, before we apply any tricks, it seems that <code>Milegae</code> and <code>Gamingtime</code> are better than <code>Icecream</code> to classify the data points.</p>
<div id="47f54e92" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb27-2"><a href="#cb27-2"></a>sns.pairplot(data<span class="op">=</span>df, hue<span class="op">=</span><span class="st">'Rating'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_files/figure-html/cell-22-output-1.png" width="774" height="709" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="applying-knn" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="applying-knn"><span class="header-section-number">2.3.3</span> Applying kNN</h3>
<p>Similar to the previous example, we will apply both methods for comparisons.</p>
<div id="195ba307" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb28-2"><a href="#cb28-2"></a>X <span class="op">=</span> np.array(df[[<span class="st">'Mileage'</span>, <span class="st">'Gamingtime'</span>, <span class="st">'Icecream'</span>]])</span>
<span id="cb28-3"><a href="#cb28-3"></a>y <span class="op">=</span> np.array(df[<span class="st">'Rating'</span>])</span>
<span id="cb28-4"><a href="#cb28-4"></a></span>
<span id="cb28-5"><a href="#cb28-5"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.1</span>, random_state<span class="op">=</span><span class="dv">40</span>, stratify<span class="op">=</span>y)</span>
<span id="cb28-6"><a href="#cb28-6"></a></span>
<span id="cb28-7"><a href="#cb28-7"></a>X_train_norm, parameters <span class="op">=</span> encodeNorm(X_train)</span>
<span id="cb28-8"><a href="#cb28-8"></a>X_test_norm, _ <span class="op">=</span> encodeNorm(X_test, parameters<span class="op">=</span>parameters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Using our codes.</li>
</ul>
<div id="4b990589" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># Using our codes.</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>n_neighbors <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>y_pred <span class="op">=</span> np.array([classify_kNN(row, X_train_norm, y_train, k<span class="op">=</span>n_neighbors)</span>
<span id="cb29-4"><a href="#cb29-4"></a>                   <span class="cf">for</span> row <span class="kw">in</span> X_test_norm])</span>
<span id="cb29-5"><a href="#cb29-5"></a></span>
<span id="cb29-6"><a href="#cb29-6"></a>acc <span class="op">=</span> np.mean(y_pred <span class="op">==</span> y_test)</span>
<span id="cb29-7"><a href="#cb29-7"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>0.93</code></pre>
</div>
</div>
<ul>
<li>Using sklearn.</li>
</ul>
<div id="b8189eab" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Using sklearn.</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb31-6"><a href="#cb31-6"></a></span>
<span id="cb31-7"><a href="#cb31-7"></a>steps <span class="op">=</span> [(<span class="st">'scaler'</span>, MinMaxScaler()),</span>
<span id="cb31-8"><a href="#cb31-8"></a>         (<span class="st">'knn'</span>, KNeighborsClassifier(n_neighbors, weights<span class="op">=</span><span class="st">"uniform"</span>,</span>
<span id="cb31-9"><a href="#cb31-9"></a>                                      metric<span class="op">=</span><span class="st">"euclidean"</span>, algorithm<span class="op">=</span><span class="st">'brute'</span>))]</span>
<span id="cb31-10"><a href="#cb31-10"></a>pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>steps)</span>
<span id="cb31-11"><a href="#cb31-11"></a>pipe.fit(X_train, y_train)</span>
<span id="cb31-12"><a href="#cb31-12"></a>y_pipe <span class="op">=</span> pipe.predict(X_test)</span>
<span id="cb31-13"><a href="#cb31-13"></a>accuracy_score(y_pipe, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>0.93</code></pre>
</div>
</div>
</section>
<section id="choosing-k-value" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="choosing-k-value"><span class="header-section-number">2.3.4</span> Choosing <code>k</code> Value</h3>
<p>Similar to the previous section, we can run tests on <code>k</code> value to choose one to be used in our model using <code>GridSearchCV</code>.</p>
<div id="119b8907" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV, cross_val_score</span>
<span id="cb33-2"><a href="#cb33-2"></a>n_list <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">101</span>))</span>
<span id="cb33-3"><a href="#cb33-3"></a>parameters <span class="op">=</span> <span class="bu">dict</span>(knn__n_neighbors<span class="op">=</span>n_list)</span>
<span id="cb33-4"><a href="#cb33-4"></a>clf <span class="op">=</span> GridSearchCV(pipe, parameters)</span>
<span id="cb33-5"><a href="#cb33-5"></a>clf.fit(X, y)</span>
<span id="cb33-6"><a href="#cb33-6"></a>clf.best_estimator_.get_params()[<span class="st">"knn__n_neighbors"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>4</code></pre>
</div>
</div>
<p>From this result, in this case the best <code>k</code> is <code>4</code>. The corresponding cross-validation score is computed below.</p>
<div id="a963f1e5" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>cv_scores <span class="op">=</span> cross_val_score(clf.best_estimator_, X, y, cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb35-2"><a href="#cb35-2"></a>np.mean(cv_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>0.952</code></pre>
</div>
</div>
</section>
</section>
<section id="k-nn-project-3-handwritten-recognition" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="k-nn-project-3-handwritten-recognition"><span class="header-section-number">2.4</span> k-NN Project 3: Handwritten recognition</h2>
<p>We would like to let the machine recognize handwritten digits. The dataset comes from the <a href="https://archive.ics.uci.edu/dataset/80/optical+recognition+of+handwritten+digits">UCI dataset repository</a>. Now we apply kNN algrotithm to it.</p>
<section id="dataset-description" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="dataset-description"><span class="header-section-number">2.4.1</span> Dataset description</h3>
<p>Every digit is stored as a <span class="math inline">\(8\times8\)</span> picture. This is a <span class="math inline">\(8\times8\)</span> matrix. Every entry represents a gray value of the corresponding pixel, whose value is from 0 to 16. The label of each matrix is the digit it represents. Note that the dataset provided is already splitted into a training set and a test set.</p>
<div id="d3ecc93b" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a><span class="im">from</span> sklearn <span class="im">import</span> datasets</span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb37-3"><a href="#cb37-3"></a></span>
<span id="cb37-4"><a href="#cb37-4"></a>X <span class="op">=</span> datasets.load_digits().images</span>
<span id="cb37-5"><a href="#cb37-5"></a>y <span class="op">=</span> datasets.load_digits().target</span>
<span id="cb37-6"><a href="#cb37-6"></a></span>
<span id="cb37-7"><a href="#cb37-7"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">.15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us play with these data first.</p>
<div id="148c1cda" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>X_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>(1527, 8, 8)</code></pre>
</div>
</div>
<div id="dda61219" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a>y_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>(1527,)</code></pre>
</div>
</div>
<div id="e75b25d9" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a>X_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>(270, 8, 8)</code></pre>
</div>
</div>
<div id="88feb02c" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a>y_test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>(270,)</code></pre>
</div>
</div>
<div id="cd66022c" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a><span class="bu">type</span>(X_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>numpy.ndarray</code></pre>
</div>
</div>
<p>From these information we can see that the training set contains 1527 digits and the test set contains 270 digits. Each digit is represented by a <span class="math inline">\(8\times8\)</span> numpy array. Let us load one and display the digit by <code>matplotlib.pyplot.imshow</code>.</p>
<div id="9177b16d" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a>digit <span class="op">=</span> X_train[<span class="dv">0</span>]</span>
<span id="cb48-2"><a href="#cb48-2"></a></span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb48-4"><a href="#cb48-4"></a>plt.imshow(digit, cmap<span class="op">=</span><span class="st">'gray'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="intro_files/figure-html/cell-35-output-1.png" width="407" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This image represents a handwritten digit. Could you recognize it? We could check our guess by looking at the label. The following shows that it is a 0.</p>
<div id="1a8d1147" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a>y_train[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>0</code></pre>
</div>
</div>
<p>Now we need to reshape these digits from <span class="math inline">\(8\times8\)</span> numpy arraies to <span class="math inline">\(64\)</span> numpy arraies. Similar to previous examples, we will also normalize the dataset.</p>
<div id="abfae89a" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a>X_train <span class="op">=</span> X_train.reshape((X_train.shape[<span class="dv">0</span>], X_train.shape[<span class="dv">1</span>]<span class="op">*</span>X_train.shape[<span class="dv">2</span>]))</span>
<span id="cb51-2"><a href="#cb51-2"></a>X_test <span class="op">=</span> X_test.reshape((X_test.shape[<span class="dv">0</span>], X_test.shape[<span class="dv">1</span>]<span class="op">*</span>X_test.shape[<span class="dv">2</span>]))</span>
<span id="cb51-3"><a href="#cb51-3"></a></span>
<span id="cb51-4"><a href="#cb51-4"></a>X_train_norm, parameters <span class="op">=</span> encodeNorm(X_train)</span>
<span id="cb51-5"><a href="#cb51-5"></a>X_test_norm, _ <span class="op">=</span> encodeNorm(X_test, parameters<span class="op">=</span>parameters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="apply-k-nn" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="apply-k-nn"><span class="header-section-number">2.4.2</span> Apply k-NN</h3>
<p>Like the previous two examples, we now try to apply the k-NN algorithm to classify these handwritten digits.</p>
<div id="5eeb438f" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb52-2"><a href="#cb52-2"></a></span>
<span id="cb52-3"><a href="#cb52-3"></a>n_neighbors <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb52-4"><a href="#cb52-4"></a>X_test_sample <span class="op">=</span> X_test_norm</span>
<span id="cb52-5"><a href="#cb52-5"></a>y_test_sample <span class="op">=</span> y_test</span>
<span id="cb52-6"><a href="#cb52-6"></a>y_pred <span class="op">=</span> np.array([classify_kNN(row, X_train_norm, y_train, k<span class="op">=</span>n_neighbors)</span>
<span id="cb52-7"><a href="#cb52-7"></a>                   <span class="cf">for</span> row <span class="kw">in</span> X_test_sample])</span>
<span id="cb52-8"><a href="#cb52-8"></a></span>
<span id="cb52-9"><a href="#cb52-9"></a>acc <span class="op">=</span> np.mean(y_pred <span class="op">==</span> y_test_sample)</span>
<span id="cb52-10"><a href="#cb52-10"></a>acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>0.9814814814814815</code></pre>
</div>
</div>
<p>Now let us try to apply <code>sklearn</code> package. Note that we could run the code over the whole test set (which contains 10000 digits) and the speed is much faster comparing to our codes. To save time we won’t grid search <code>k</code> here. The code is the same anyway.</p>
<div id="76ea159d" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb54-3"><a href="#cb54-3"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb54-4"><a href="#cb54-4"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb54-5"><a href="#cb54-5"></a></span>
<span id="cb54-6"><a href="#cb54-6"></a>steps <span class="op">=</span> [(<span class="st">'scaler'</span>, MinMaxScaler()),</span>
<span id="cb54-7"><a href="#cb54-7"></a>         (<span class="st">'knn'</span>, KNeighborsClassifier(n_neighbors, weights<span class="op">=</span><span class="st">"uniform"</span>,</span>
<span id="cb54-8"><a href="#cb54-8"></a>                                      metric<span class="op">=</span><span class="st">"euclidean"</span>, algorithm<span class="op">=</span><span class="st">'brute'</span>))]</span>
<span id="cb54-9"><a href="#cb54-9"></a>pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>steps)</span>
<span id="cb54-10"><a href="#cb54-10"></a>pipe.fit(X_train, y_train)</span>
<span id="cb54-11"><a href="#cb54-11"></a>y_pipe <span class="op">=</span> pipe.predict(X_test)</span>
<span id="cb54-12"><a href="#cb54-12"></a>accuracy_score(y_pipe, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>0.9814814814814815</code></pre>
</div>
</div>
</section>
</section>
<section id="exercises-and-projects" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="exercises-and-projects"><span class="header-section-number">2.5</span> Exercises and Projects</h2>
<div id="exr-ex2handwritten" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.1</strong></span> Handwritten example :label: ex2handwritten Consider the 1-dimensional data set shown below.</p>
<div id="6d8231d4" class="cell" data-execution_count="39">
<div class="cell-output cell-output-display" data-execution_count="36">
<style type="text/css">
</style>

<table id="T_032bb" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th id="T_032bb_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">x</th>
<th id="T_032bb_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">1.5</th>
<th id="T_032bb_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">2.5</th>
<th id="T_032bb_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">3.5</th>
<th id="T_032bb_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">4.5</th>
<th id="T_032bb_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">5.0</th>
<th id="T_032bb_level0_col6" class="col_heading level0 col6" data-quarto-table-cell-role="th">5.5</th>
<th id="T_032bb_level0_col7" class="col_heading level0 col7" data-quarto-table-cell-role="th">5.75</th>
<th id="T_032bb_level0_col8" class="col_heading level0 col8" data-quarto-table-cell-role="th">6.5</th>
<th id="T_032bb_level0_col9" class="col_heading level0 col9" data-quarto-table-cell-role="th">7.5</th>
<th id="T_032bb_level0_col10" class="col_heading level0 col10" data-quarto-table-cell-role="th">10.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_032bb_row0_col0" class="data row0 col0">y</td>
<td id="T_032bb_row0_col1" class="data row0 col1">+</td>
<td id="T_032bb_row0_col2" class="data row0 col2">+</td>
<td id="T_032bb_row0_col3" class="data row0 col3">-</td>
<td id="T_032bb_row0_col4" class="data row0 col4">-</td>
<td id="T_032bb_row0_col5" class="data row0 col5">-</td>
<td id="T_032bb_row0_col6" class="data row0 col6">+</td>
<td id="T_032bb_row0_col7" class="data row0 col7">+</td>
<td id="T_032bb_row0_col8" class="data row0 col8">-</td>
<td id="T_032bb_row0_col9" class="data row0 col9">+</td>
<td id="T_032bb_row0_col10" class="data row0 col10">+</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Please use the data to compute the class of <span class="math inline">\(x=5.5\)</span> according to <span class="math inline">\(k=1\)</span>, <span class="math inline">\(3\)</span>, <span class="math inline">\(6\)</span> and <span class="math inline">\(9\)</span>. Please compute everything by hand.</p>
</div>
<div id="exr-ex2titanic" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.2 (Titanic)</strong></span> Please download the titanic dataset from <a href="./assests/datasets/titanic.csv">here</a>. This is the same dataset from what you dealt with in Chapter 1 Exercises. Therefore you may use the same way to prepare the data.</p>
<p>Please analyze the dataset and build a k-NN model to predict whether someone is survived or not. Note that you have to pick <code>k</code> at the end.</p>
</div>


<div id="refs" class="references csl-bib-body" role="list" style="display: none">
<div id="ref-Har2012" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline"><span class="smallcaps">Harrington</span>, P. (2012). <em><a href="https://www.manning.com/books/machine-learning-in-action">Machine learning in action</a></em>. Manning Publications.</div>
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../contents/1/intro.html" class="pagination-link  aria-label=" &lt;span="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../contents/3/intro.html" class="pagination-link" aria-label="<span class='chapter-number'>3</span>&nbsp; <span class='chapter-title'>Decision Trees</span>">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Decision Trees</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>